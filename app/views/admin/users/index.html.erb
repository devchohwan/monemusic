<div class="max-w-4xl mx-auto">
  <h2 class="text-2xl font-bold mb-6">회원 관리</h2>
  
  <% if @pending_users.any? %>
    <div class="mb-8">
      <h3 class="text-lg font-medium mb-3">승인 대기 회원</h3>
      <div class="space-y-2">
        <% @pending_users.each do |user| %>
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div class="flex justify-between items-start">
              <div>
                <p class="font-medium"><%= user.name %></p>
                <p class="text-sm text-gray-600">
                  아이디: <%= user.username %> | 이메일: <%= user.email %>
                </p>
                <p class="text-sm text-gray-600">
                  담당: 
                  <%= form_with url: update_teacher_admin_user_path(user), method: :patch, style: "display: inline-block;" do |f| %>
                    <%= f.select :teacher,
                        options_for_select(User::TEACHERS, user.teacher),
                        {},
                        class: "text-xs px-2 py-1 border border-gray-300 rounded",
                        onchange: "this.form.requestSubmit()" %>
                  <% end %>
                </p>
                <p class="text-xs text-gray-500 mt-1">
                  가입일: <%= user.created_at.strftime('%Y-%m-%d %H:%M') %>
                </p>
              </div>
              <div class="flex gap-2">
                <%= link_to "승인", approve_admin_user_path(user), 
                            method: :patch, 
                            data: { turbo_method: :patch },
                            class: "bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700" %>
                <%= link_to "거부", reject_admin_user_path(user), 
                            method: :patch, 
                            data: { turbo_method: :patch, turbo_confirm: "정말 거부하시겠습니까?" },
                            class: "bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
  
  <div>
    <h3 class="text-lg font-medium mb-3">승인된 회원</h3>
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <table class="w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">이름</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">아이디</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">비밀번호</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">담당</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">가입일</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">관리</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <% @approved_users.each do |user| %>
            <tr>
              <td class="px-4 py-3 text-sm"><%= user.name %></td>
              <td class="px-4 py-3 text-sm"><%= user.username %></td>
              <td class="px-4 py-3 text-sm">
                <span class="text-xs text-gray-500">암호화됨</span>
                <button onclick="resetPassword('<%= user.username %>')" class="ml-2 text-xs text-blue-600 hover:text-blue-800">초기화</button>
              </td>
              <td class="px-4 py-3 text-sm">
                <%= form_with url: update_teacher_admin_user_path(user), method: :patch, style: "display: inline-block;" do |f| %>
                  <%= f.select :teacher,
                      options_for_select(User::TEACHERS, user.teacher),
                      {},
                      class: "text-xs px-2 py-1 border border-gray-300 rounded",
                      onchange: "this.form.requestSubmit()" %>
                <% end %>
              </td>
              <td class="px-4 py-3 text-sm"><%= user.created_at.strftime('%Y-%m-%d') %></td>
              <td class="px-4 py-3 text-sm">
                <% unless user.is_admin? %>
                  <%= link_to "삭제", admin_user_path(user), 
                              method: :delete,
                              data: { turbo_method: :delete, turbo_confirm: "정말 삭제하시겠습니까?" },
                              class: "text-red-600 hover:text-red-800 text-sm" %>
                <% else %>
                  <span class="text-gray-400 text-sm">관리자</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  
  <div class="mt-6">
    <%= link_to "관리자 대시보드로", admin_root_path, class: "text-gray-600 text-sm" %>
  </div>
</div>

<script>
function resetPassword(username) {
  const newPassword = prompt(`${username}의 새 비밀번호를 입력하세요 (최소 6자):`);
  if (newPassword && newPassword.length >= 6) {
    // 비밀번호 재설정 폼 제출
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/admin/users/' + username + '/reset_password';
    
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'authenticity_token';
    csrfInput.value = csrfToken;
    
    const methodInput = document.createElement('input');
    methodInput.type = 'hidden';
    methodInput.name = '_method';
    methodInput.value = 'patch';
    
    const passwordInput = document.createElement('input');
    passwordInput.type = 'hidden';
    passwordInput.name = 'password';
    passwordInput.value = newPassword;
    
    form.appendChild(csrfInput);
    form.appendChild(methodInput);
    form.appendChild(passwordInput);
    document.body.appendChild(form);
    form.submit();
  } else if (newPassword) {
    alert('비밀번호는 최소 6자 이상이어야 합니다.');
  }
}
</script>